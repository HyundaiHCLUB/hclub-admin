<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="site.hclub.hyndai.mapper.MemberMapper">

	<select id="getRatingRankList" parameterType="site.hclub.hyndai.dto.MemberDTO" resultType="site.hclub.hyndai.dto.MemberDTO">
		 SELECT 
		 	 ROWNUM 
        	, T1.memberNo
        	, T1.memberId
        	, T1.memberImage
        	, T1. memberInterest
        	, T1.memberRating
        	, T1.employeeNo
        	, T1.adminYn
        	, T1.matchNum
        	, E.EMPLOYEE_NAME AS employeeName
		 FROM (
			<include refid="getMemberBase"></include>
		 ) T1
		 INNER JOIN EMPLOYEE E
    	ON E.EMPLOYEE_NO = T1.employeeNo
		
	</select>
	<sql id="getMemberBase">
	  SELECT 
		    M.MEMBER_NO as memberNo
		    , M.MEMBER_ID as memberId
		    , M.MEMBER_IMAGE as memberImage
		    , M.MEMBER_INTEREST as memberInterest
		    , M.MEMBER_RATING as memberRating
		    , M.EMPLOYEE_NO as employeeNo
		    , M.MEMBER_PW as memberPw
		    , M.ADMIN_YN as adminYn
            , (SELECT  COUNT(*)
                FROM MEMBER_TEAM MT
                WHERE MT.MEMBER_NO = M.MEMBER_NO
             ) AS matchNum
		FROM MEMBER M
		ORDER BY MEMBER_RATING DESC 
	</sql>
</mapper>